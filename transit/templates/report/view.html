{% extends "base_generic.html" %}
{% block title_section %}
{% if user.is_authenticated %}Report for: {{date_start}} - {{date_end}} | {% endif %}
{% endblock %}

{% block auth_content %}
{% load static %}
<form id="show_daily_data_form" action="" method="post">
    {% csrf_token %}
    <input type="hidden" name="show_daily_data">
</form>

<div class="container-fluid mt-4 mb-3">
    <div class="row">
        <div class="col p-1">
            <h5>Report for: <strong>{{ date_start }} - {{ date_end }}</strong></h5>
        </div>
        <div class="col-auto p-1">
            <span class="dropdown">
                <a href="#_" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Print the schedule or daily log">
                    <span class="oi oi-print mr-2"></span>Print
                </a>
                <div class="dropdown-menu shadow dropdown-menu-right">
                    <a class="dropdown-item" href="{{ url_print }}" target="_blank"><span class="oi oi-graph mr-2"></span>Print Report</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="{{ url_print_mile_summary}}" target="_blank"><span class="oi oi-spreadsheet mr-2"></span>Print Mileage Summary</a>
                </div>
            </span>
        </div>
        <div class="col-auto p-1">
            <a class="btn btn-primary" href="{{ url_xlsx }}"><span class="oi oi-data-transfer-download mr-2"></span>Download as Excel</a>
        </div>
        <div class="col-sm-auto p-1">
            <div class="btn-group" role="group">
                <a title="Previous month" class="btn btn-secondary" href="{{ url_month_prev }}">
                    <span class="oi oi-chevron-left"></span>
                </a>
                <div class="btn-group" role="group" id="date_dropdown">
                    <button title="Select a month" class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="oi oi-calendar"></span>
                    </button>
                    <div class="dropdown-menu shadow dropdown-menu-right">
                        <div class="p-2" style="white-space: nowrap;">
                            <form action="" method="post" class="date-picker">
                                {% csrf_token %}
                                {{ date_picker }}
                                <input type="submit" value="Go" class="btn btn-secondary align-top">
                            </form>
                        </div>
                        <a class="dropdown-item" href="{{ url_this_month }}">Go to this month</a>
                        <div class="dropdown-divider"></div>
                        <div class="p-2 small"><strong>Custom Date Range</strong></div>
                        <div class="p-2" style="white-space: nowrap;">
                            <form action="" method="post" class="date-picker">
                                {% csrf_token %}
                                <div class="mb-2">
                                    {{ date_range_picker.date_start }}
                                </div>
                                <div class="mb-2">
                                    {{ date_range_picker.date_end }}
                                </div>
                                <div>
                                    <button class="btn btn-secondary align-top w-100" type="submit" name="date_range">Go</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <a title="Next month" class="btn btn-secondary" href="{{ url_month_next }}">
                    <span class="oi oi-chevron-right"></span>
                </a>
            </div>
        </div>
    </div>
    <div class="row justify-content-end mt-3">
        <div class="col-auto top-right-nav">
            <span class="dropdown">
                <a href="#_" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Filter by driver">
                    <span class="oi oi-eye mr-2"></span>Filter by driver{% if selected_driver %}: {{ selected_driver }}{% endif %}
                </a>
                    <div class="dropdown-menu shadow dropdown-menu-right">
                        <a class="dropdown-item {% if selected_driver is None %}active{% endif %}" href="{% url 'report' date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day %}">
                            ---------
                        </a>
                        <div class="dropdown-divider"></div>
                        {% for driver in drivers %}
                        <a class="dropdown-item {% if driver.id == selected_driver.id %}active{% endif %}" href="{% url 'report-driver' driver.id date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day %}">
                            {{ driver }}
                        </a>
                        {% endfor %}
                    </div>
            </span>
        </div>
        {% if not is_short_report %}
        <div class="col-auto">
            <button onclick="document.getElementById('show_daily_data_form').submit();" class="btn {% if show_daily_data %}btn-secondary{% else %}btn-warning{% endif %} btn-sm">
                <span class="oi oi-calendar mr-2"></span>{% if show_daily_data %}Hide daily report data{% else %}Show daily report data{% endif %}
            </button>
        </div>
        {% endif %}
        <div id="vis_all" class="col-auto d-none">
            <a href="#_" class="btn btn-warning btn-sm" onclick="visibleShowAll(visible)"><span class="oi oi-eye mr-2"></span>Show all sections</a>
        </div>
        <div class="col-auto">
            <div class="dropdown prevent-select">
                <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="section_dropdown_toggle">
                    <span class="oi oi-list mr-2"></span>Sections
                </button>
                <div class="dropdown-menu shadow dropdown-menu-right" id="section_dropdown">
                    <a class="dropdown-item" onclick="visibleShowAll(visible)"><span class="oi oi-eye mr-2"></span>Show all sections</a>
                    <div class="dropdown-divider"></div>
                    {% if report.report_errors.errors %}
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_errors" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_errors')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_errors" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_errors" class="m-0 text-danger">Errors</label>
                    </div>
                    <div class="dropdown-divider"></div>
                    {% endif %}
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_MAP" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_MAP')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_MAP" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_MAP" class="m-0">Mobility Assistance Program (MAP)</label>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_vehicle_totals" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_vehicle_totals')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_vehicle_totals" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_vehicle_totals" class="m-0">Totals for All Vehicles</label>
                    </div>
                    {% for v in report.vehicle_reports %}
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_vehicle_{{v.vehicle.id}}" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_vehicle_{{v.vehicle.id}}')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_vehicle_{{v.vehicle.id}}" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_vehicle_{{v.vehicle.id}}" class="m-0">Vehicle: {{v.vehicle}}</label>
                    </div>
                    {% endfor %}
                    {% if report.unique_riders.names %}
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_riders" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_riders')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_riders" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_riders" class="m-0">Elderly/Ambulatory Riders</label>
                    </div>
                    {% endif %}
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_tags" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_tags')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_tags" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_tags" class="m-0">Trip Types and Tags</label>
                    </div>
                    {% if report.frequent_destinations %}
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_destinations" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_destinations')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_destinations" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_destinations" class="m-0">Frequent Destinations</label>
                    </div>
                    {% endif %}
                    {% if report.unique_riders.names or report.money_payments %}
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_fares" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_fares')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_fares" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_fares" class="m-0">Fares &amp; Payments (by client)</label>
                    </div>
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_fares_by_date" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_fares_by_date')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_fares_by_date" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_fares_by_date" class="m-0">Fares &amp; Payments (by date)</label>
                    </div>
                    {% endif %}
                    {% if report.money_trips %}
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_collected_money" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_collected_money')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_collected_money" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_collected_money" class="m-0">Money Collected by the Drivers</label>
                    </div>
                    {% endif %}
                    {% if report.money_payments %}
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_payments" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_payments')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_payments" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_payments" class="m-0">Money Not Collected by the Drivers</label>
                    </div>
                    {% endif %}
                    {% if report.driver_reports %}
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">
                        <div class="btn-group mr-1">
                            <a title="Jump to this section" class="btn btn-sm btn-secondary pt-0 pb-0" href="#report_drivers" onclick="$('#section_dropdown_toggle').dropdown('toggle')"><span class="oi oi-arrow-bottom"></span></a>
                            <a title="Show only this section" class="btn btn-sm btn-primary pt-0 pb-0" onclick="visibleSolo(visible, '#vis_drivers')"><span class="oi oi-eye"></span></a>
                        </div>
                        <input id="vis_drivers" type="checkbox" onclick="visibleSave(visible, true)">
                        <label for="vis_drivers" class="m-0">Per-Driver Summary</label>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% if selected_driver %}
<div class="alert alert-warning">
    <p>This report is showing only trips from the following driver: <strong>{{selected_driver}}</strong>.</p>
    {% if not selected_driver.is_logged %}
    <p>The selected driver has been flagged to not be included in general reports.<br/>
    Since they have been explicitly selected, that setting is ignored here.</p>
    {% endif %}
    <p>To view the standard report, <a class="alert-link" href="{% url 'report' date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day %}">click here</a>.</p>
</div>
{% endif %}
<div>
{% if report.report_errors.errors %}
<div id="report_errors">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Errors</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <div style="max-width: 800px;">
        <ul class="list-group">
        {% for error in report.report_errors.errors %}
        <li class="list-group-item list-group-item-danger p-2 small">
            <strong class="text-danger">Error:</strong>
            {% if error.error_shift and not error.error_trip %}
                <span class="text-bold">{{ error.error_msg }}</span><br/>
                <div class="mb-2">{{ error.error_shift }}</div>
                <a class="btn btn-sm btn-danger" href="{% url 'schedule' 'edit' error.date.year error.date.month error.date.day %}#shift_{{ error.error_shift.id }}"><span class="oi oi-spreadsheet mr-2"></span>View on schedule</a>
                <a class="btn btn-sm btn-danger" href="{% url 'report-shift-edit' date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day error.error_shift.id %}"><span class="oi oi-pencil mr-2"></span>Edit Shift</a>
            {% elif error.error_trip %}
                <span class="text-bold">{{ error.error_msg }}</span><br/>
                <div class="mb-2">{{ error.error_trip }}</div>
                <a class="btn btn-sm btn-danger" href="{% url 'schedule' 'edit' error.date.year error.date.month error.date.day %}#trip_{{ error.error_trip.id }}"><span class="oi oi-spreadsheet mr-2"></span>View on schedule</a>
                <a class="btn btn-sm btn-danger" href="{% url 'report-trip-edit' date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day error.error_trip.id %}"><span class="oi oi-pencil mr-2"></span>Edit Trip</a>
            {% else %}
                <span class="text-bold">{{ error.error_msg }}</span><br/>
                <a class="btn btn-sm btn-danger" href="{% url 'schedule' 'edit' error.date.year error.date.month error.date.day %}"><span class="oi oi-spreadsheet mr-2"></span>View schedule</a>
            {% endif %}
        </li>
        {% endfor %}
        </ul>
    </div>
</div>
{% endif%}

<div id="report_MAP">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Mobility Assistance Program (MAP)</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <h4>Passenger Description (Unduplicated riders)</h4>
    <table class="mytable mytable-striped mb-3">
        <thead>
            <td class="mytable-col-md"></td>
            <td class="mytable-col-md text-center">Elderly Ambulatory</td>
            <td class="mytable-col-md text-center">Elderly Non-Ambulatory</td>
            <td class="mytable-col-md text-center">Non-Elderly Ambulatory</td>
            <td class="mytable-col-md text-center">Non-Elderly Non-Ambulatory</td>
            <td class="mytable-col-md text-center">Unknown</td>
            <td class="mytable-col-md text-center">Total</td>
        </thead>
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-md text-center">{{ report.unique_riders.by_individuals.0.total }}</td>
            <td class="mytable-col-md text-center">{{ report.unique_riders.by_individuals.1.total }}</td>
            <td class="mytable-col-md text-center">{{ report.unique_riders.by_individuals.2.total }}</td>
            <td class="mytable-col-md text-center">{{ report.unique_riders.by_individuals.3.total }}</td>
            <td class="mytable-col-md text-center">{{ report.unique_riders.by_individuals.4.total }}</td>
            <td class="mytable-col-md text-center">{{ report.unique_riders.by_individuals.5.total }}</td>
        </tr>
    </table>
    <h4>Operational Information (All vehicles)</h4>
    <table class="mytable mytable-striped mb-3">
        <thead>
            <td class="mytable-col-md"></td>
            <td class="mytable-col-md text-center">Days of Service</td>
            <td class="mytable-col-md text-center">Service Hours</td>
            <td class="mytable-col-md text-center">Odometer Miles</td>
        </thead>
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-md text-center">{{ report.total_vehicle_days_of_service }}</td>
            <td class="mytable-col-md text-center">{{ report.all_vehicles.service_hours|floatformat:2 }}</td>
            <td class="mytable-col-md text-center">{{ report.total_odometer_miles }}</td>
        </tr>
    </table>
    <h4>Total Number of One-Way Trips Provided</h4>
    <table class="mytable mytable-striped mb-3">
        <thead>
            <td class="mytable-col-md"></td>
            {% for key, value in report.all_vehicles.trip_types.items %}
            <td class="mytable-col-sm">Trips: {{key}}</td>
            {% endfor %}
            <td class="mytable-col-sm">Total Trips</td>
        </thead>
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            {% for key, value in report.all_vehicles.trip_types.items %}
            <td class="mytable-col-sm">{{value.total}}</td>
            {% endfor %}
            <td class="mytable-col-sm">{{report.all_vehicles.trip_types_total.total}}</td>
        </tr>
    </table>
    <h4>Supplemental Information</h4>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md"></td>
            <td class="mytable-col-sm">Fuel</td>
            <td class="mytable-col-sm">Deadhead Hours</td>
            <td class="mytable-col-sm">Deadhead Miles</td>
            <td class="mytable-col-sm">Passenger Miles</td>
            <td class="mytable-col-sm">Total Money</td>
        </thead>
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-sm">{{report.all_vehicles.fuel|floatformat:1}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.deadhead_hours|floatformat:2}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.deadhead_miles|floatformat:1}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.pmt|floatformat:1}}</td>
            <td class="mytable-col-sm">{{report.total_money}}</td>
        </tr>
    </table>
</div>

<div id="report_vehicle_totals">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Totals for All Vehicles</h3>
            {% if report.report_all %}<p>Days of service: <strong>{{ report.total_vehicle_days_of_service }}</strong></p>{% endif %}
            <p class="text-muted small">Note: Trip counts are divided into three values: trips with passengers, trips without passengers, and a grand total.</p>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md"></td>
            <td class="mytable-col-sm">Service Miles</td>
            <td class="mytable-col-sm">Service Hours</td>
            <td class="mytable-col-sm">Deadhead Miles</td>
            <td class="mytable-col-sm">Deadhead Hours</td>
            <td class="mytable-col-sm">Passenger Miles</td>
            <td class="mytable-col-sm">Fuel</td>
            {% for key, value in report.all_vehicles.trip_types.items %}
            <td class="mytable-col-sm" colspan=3>Trips: {{key}}</td>
            {% endfor %}
            <td class="mytable-col-sm" colspan=3>Total Trips</td>
            <td class="mytable-col-sm">Cash Collected</td>
            <td class="mytable-col-sm">Checks Collected</td>
            <td class="mytable-col-sm">Total Money</td>
        </thead>
        {% if show_daily_data or is_short_report %}
        <tbody class="mytable-hoverhi">
            {% for day in report.report_all %}
            {% if day.hasVehicleInShift %}
            <tr>
                <td class="mytable-col-md"><a href="{% url 'schedule' 'edit' day.date.year day.date.month day.date.day %}">{{day.date|date:"M j, Y"}}</a></td>
                <td class="mytable-col-sm {% if day.all.service_miles == 0 %}mytable-zero{%endif%}">{{day.all.service_miles|floatformat:1}}</td>
                <td class="mytable-col-sm {% if day.all.service_hours == 0 %}mytable-zero{%endif%}">{{day.all.service_hours|floatformat:2}}</td>
                <td class="mytable-col-sm {% if day.all.deadhead_miles == 0 %}mytable-zero{%endif%}">{{day.all.deadhead_miles|floatformat:1}}</td>
                <td class="mytable-col-sm {% if day.all.deadhead_hours == 0 %}mytable-zero{%endif%}">{{day.all.deadhead_hours|floatformat:2}}</td>
                <td class="mytable-col-sm {% if day.all.pmt == 0 %}mytable-zero{%endif%}">{{day.all.pmt|floatformat:1}}</td>
                <td class="mytable-col-sm {% if day.all.fuel == 0 %}mytable-zero{%endif%}">{{day.all.fuel|floatformat:1}}</td>
                {% for key, value in day.all.trip_types.items %}
                <td class="mytable-col-xxs small {% if value.passenger == 0 %}mytable-zero{%endif%}">{{value.passenger}}</td>
                <td class="mytable-col-xxs small {% if value.no_passenger == 0 %}mytable-zero{%endif%}">{{value.no_passenger}}</td>
                <td class="mytable-col-xxs {% if value.total == 0 %}mytable-zero{%endif%}">{{value.total}}</td>
                {% endfor %}
                <td class="mytable-col-xxs small {% if day.all.trip_types_total.passenger == 0 %}mytable-zero{%endif%}">{{day.all.trip_types_total.passenger}}</td>
                <td class="mytable-col-xxs small {% if day.all.trip_types_total.no_passenger == 0 %}mytable-zero{%endif%}">{{day.all.trip_types_total.no_passenger}}</td>
                <td class="mytable-col-xxs {% if day.all.trip_types_total.total == 0 %}mytable-zero{%endif%}">{{day.all.trip_types_total.total}}</td>
                <td class="mytable-col-sm {% if day.all.collected_cash.value == 0 %}mytable-zero{%endif%}">{{day.all.collected_cash}}</td>
                <td class="mytable-col-sm {% if day.all.collected_check.value == 0 %}mytable-zero{%endif%}">{{day.all.collected_check}}</td>
                <td class="mytable-col-sm {% if day.all.total_collected_money.value == 0 %}mytable-zero{%endif%}">{{day.all.total_collected_money}}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
        <thead>
            <td class="mytable-col-md"></td>
            <td class="mytable-col-sm">Service Miles</td>
            <td class="mytable-col-sm">Service Hours</td>
            <td class="mytable-col-sm">Deadhead Miles</td>
            <td class="mytable-col-sm">Deadhead Hours</td>
            <td class="mytable-col-sm">Passenger Miles</td>
            <td class="mytable-col-sm">Fuel</td>
            {% for key, value in report.all_vehicles.trip_types.items %}
            <td class="mytable-col-sm" colspan=3>Trips: {{key}}</td>
            {% endfor %}
            <td class="mytable-col-sm" colspan=3>Total Trips</td>
            <td class="mytable-col-sm">Cash Collected</td>
            <td class="mytable-col-sm">Checks Collected</td>
            <td class="mytable-col-sm">Total Money</td>
        </thead>
        {% endif %}
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-sm">{{report.all_vehicles.service_miles|floatformat:1}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.service_hours|floatformat:2}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.deadhead_miles|floatformat:1}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.deadhead_hours|floatformat:2}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.pmt|floatformat:1}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.fuel|floatformat:1}}</td>
            {% for key, value in report.all_vehicles.trip_types.items %}
            <td class="mytable-col-xxs small">{{value.passenger}}</td>
            <td class="mytable-col-xxs small">{{value.no_passenger}}</td>
            <td class="mytable-col-xxs">{{value.total}}</td>
            {% endfor %}
            <td class="mytable-col-xxs small">{{report.all_vehicles.trip_types_total.passenger}}</td>
            <td class="mytable-col-xxs small">{{report.all_vehicles.trip_types_total.no_passenger}}</td>
            <td class="mytable-col-xxs">{{report.all_vehicles.trip_types_total.total}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.collected_cash}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.collected_check}}</td>
            <td class="mytable-col-sm">{{report.all_vehicles.total_collected_money}}</td>
        </tr>
        {% if not show_daily_data and not is_short_report %}
        <tr>
            <td colspan="{{vehicle_table_colspan}}" class="small text-center alert-warning">Daily report data is hidden</td>
        </tr>
        {% endif %}
    </table>
</div>
{% for v in report.vehicle_reports %}
<div id="report_vehicle_{{v.vehicle.id}}">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Vehicle: {{v.vehicle}}</h3>
            {% if v.days and not v.vehicle.is_logged %}
            <div class="alert alert-info p-2 small w-50">
                The mileage and time data for this vehicle <strong>WILL NOT</strong> be included in:
                <ul class="mb-0">
                    <li><em>Mobility Assistance Program (MAP)</em></li>
                    <li><em>Totals for All Vehicles</em></li>
                </ul>
                The mileage and time data <strong>WILL</strong> be included in:
                <ul class="mb-0">
                    <li><em>Per-Driver Summary</em></li>
                </ul>
            </div>
            {% endif %}
            {% if not v.start_miles.empty and not v.end_miles.empty %}
            <p>
                Mileage Start: <strong>{{v.start_miles}}</strong><span class="oi oi-arrow-right ml-2 mr-2"></span>End: <strong>{{v.end_miles}}</strong><br/>
                Total miles: <strong>{{v.total_miles}}</strong>
                {% if v.days %}<br/>Days of service: <strong>{{ v.days|length }}</strong>{% endif %}
            </p>
            {% endif %}
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    {% if v.days %}
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md">Date</td>
            <td class="mytable-col-sm">Service Miles</td>
            <td class="mytable-col-sm">Service Hours</td>
            <td class="mytable-col-sm">Deadhead Miles</td>
            <td class="mytable-col-sm">Deadhead Hours</td>
            <td class="mytable-col-sm">Passenger Miles</td>
            <td class="mytable-col-sm">Fuel</td>
            {% for key, value in v.totals.trip_types.items %}
            <td class="mytable-col-sm" colspan=3>Trips: {{key}}</td>
            {% endfor %}
            <td class="mytable-col-sm" colspan=3>Total Trips</td>
            <td class="mytable-col-sm">Cash Collected</td>
            <td class="mytable-col-sm">Checks Collected</td>
            <td class="mytable-col-sm">Total Money</td>
        </thead>
        {% if show_daily_data or is_short_report %}
        <tbody class="mytable-hoverhi">
            {% for day in v.days %}
            <tr>
                <td class="mytable-col-md"><a href="{% url 'schedule' 'edit' day.date.year day.date.month day.date.day %}">{{day.date|date:"M j, Y"}}</a></td>
                <td class="mytable-col-sm {% if day.data.service_miles == 0 %}mytable-zero{%endif%}">{{day.data.service_miles|floatformat:1}}</td>
                <td class="mytable-col-sm {% if day.data.service_hours == 0 %}mytable-zero{%endif%}">{{day.data.service_hours|floatformat:2}}</td>
                <td class="mytable-col-sm {% if day.data.deadhead_miles == 0 %}mytable-zero{%endif%}">{{day.data.deadhead_miles|floatformat:1}}</td>
                <td class="mytable-col-sm {% if day.data.deadhead_hours == 0 %}mytable-zero{%endif%}">{{day.data.deadhead_hours|floatformat:2}}</td>
                <td class="mytable-col-sm {% if day.data.pmt == 0 %}mytable-zero{%endif%}">{{day.data.pmt|floatformat:1}}</td>
                <td class="mytable-col-sm {% if day.data.fuel == 0 %}mytable-zero{%endif%}">{{day.data.fuel|floatformat:1}}</td>
                {% for key, value in day.data.trip_types.items %}
                <td class="mytable-col-xxs small {% if value.passenger == 0 %}mytable-zero{%endif%}">{{value.passenger}}</td>
                <td class="mytable-col-xxs small {% if value.no_passenger == 0 %}mytable-zero{%endif%}">{{value.no_passenger}}</td>
                <td class="mytable-col-xxs {% if value.total == 0 %}mytable-zero{%endif%}">{{value.total}}</td>
                {% endfor %}
                <td class="mytable-col-xxs small {% if day.data.trip_types_total.passenger == 0 %}mytable-zero{%endif%}">{{day.data.trip_types_total.passenger}}</td>
                <td class="mytable-col-xxs small {% if day.data.trip_types_total.no_passenger == 0 %}mytable-zero{%endif%}">{{day.data.trip_types_total.no_passenger}}</td>
                <td class="mytable-col-xxs {% if day.data.trip_types_total.total == 0 %}mytable-zero{%endif%}">{{day.data.trip_types_total.total}}</td>
                <td class="mytable-col-sm {% if day.data.collected_cash.value == 0 %}mytable-zero{%endif%}">{{day.data.collected_cash}}</td>
                <td class="mytable-col-sm {% if day.data.collected_check.value == 0 %}mytable-zero{%endif%}">{{day.data.collected_check}}</td>
                <td class="mytable-col-sm {% if day.data.total_collected_money.value == 0 %}mytable-zero{%endif%}">{{day.data.total_collected_money}}</td>
            </tr>
            {% endfor %}
        </tbody>
        <thead>
            <td class="mytable-col-md">Date</td>
            <td class="mytable-col-sm">Service Miles</td>
            <td class="mytable-col-sm">Service Hours</td>
            <td class="mytable-col-sm">Deadhead Miles</td>
            <td class="mytable-col-sm">Deadhead Hours</td>
            <td class="mytable-col-sm">Passenger Miles</td>
            <td class="mytable-col-sm">Fuel</td>
            {% for key, value in v.totals.trip_types.items %}
            <td class="mytable-col-sm" colspan=3>Trips: {{key}}</td>
            {% endfor %}
            <td class="mytable-col-sm" colspan=3>Total Trips</td>
            <td class="mytable-col-sm">Cash Collected</td>
            <td class="mytable-col-sm">Checks Collected</td>
            <td class="mytable-col-sm">Total Money</td>
        </thead>
        {% endif %}
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-sm">{{v.totals.service_miles|floatformat:1}}</td>
            <td class="mytable-col-sm">{{v.totals.service_hours|floatformat:2}}</td>
            <td class="mytable-col-sm">{{v.totals.deadhead_miles|floatformat:1}}</td>
            <td class="mytable-col-sm">{{v.totals.deadhead_hours|floatformat:2}}</td>
            <td class="mytable-col-sm">{{v.totals.pmt|floatformat:1}}</td>
            <td class="mytable-col-sm">{{v.totals.fuel|floatformat:1}}</td>
            {% for key, value in v.totals.trip_types.items %}
            <td class="mytable-col-xxs small">{{value.passenger}}</td>
            <td class="mytable-col-xxs small">{{value.no_passenger}}</td>
            <td class="mytable-col-xxs">{{value.total}}</td>
            {% endfor %}
            <td class="mytable-col-xxs small">{{v.totals.trip_types_total.passenger}}</td>
            <td class="mytable-col-xxs small">{{v.totals.trip_types_total.no_passenger}}</td>
            <td class="mytable-col-xxs">{{v.totals.trip_types_total.total}}</td>
            <td class="mytable-col-sm">{{v.totals.collected_cash}}</td>
            <td class="mytable-col-sm">{{v.totals.collected_check}}</td>
            <td class="mytable-col-sm">{{v.totals.total_collected_money}}</td>
        </tr>
        {% if not show_daily_data and not is_short_report %}
        <tr>
            <td colspan="{{vehicle_table_colspan}}" class="small text-center alert-warning">Daily report data is hidden</td>
        </tr>
        {% endif %}
    </table>
    {% else %}
    <p>No data for this vehicle is available.</p>
    {% endif %}
</div>
{% endfor %}

{% if report.unique_riders.names %}
<div id="report_riders">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Elderly/Ambulatory Riders</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md"></td>
            <td class="mytable-col-md text-center">Elderly Ambulatory</td>
            <td class="mytable-col-md text-center">Elderly Non-Ambulatory</td>
            <td class="mytable-col-md text-center">Non-Elderly Ambulatory</td>
            <td class="mytable-col-md text-center">Non-Elderly Non-Ambulatory</td>
            <td class="mytable-col-md text-center">Unknown</td>
            <td class="mytable-col-md text-center">Total</td>
            <td class="mytable-col-md text-center">Staff</td>
            <td class="mytable-col-md text-center">Total (with staff)</td>
        </thead>
        <tr>
            <td class="mytable-col-md">On vehicle</td>
            {% for trip_count in report.unique_riders.by_individuals %}
            <td class="mytable-col-sm {% if trip_count.passenger == 0 %}mytable-zero{%endif%}">{{trip_count.passenger}}</td>
            {% endfor %}
        </tr>
        <tr>
            <td class="mytable-col-md">Not on vehicle</td>
            {% for trip_count in report.unique_riders.by_individuals %}
            <td class="mytable-col-sm {% if trip_count.no_passenger == 0 %}mytable-zero{%endif%}">{{trip_count.no_passenger}}</td>
            {% endfor %}
        </tr>
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            {% for trip_count in report.unique_riders.by_individuals %}
            <td class="mytable-col-sm text-center{% if trip_count.total == 0 %}mytable-zero{%endif%}">{{trip_count.total}}</td>
            {% endfor %}
        </tr>
    </table>
    <br/>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md"></td>
            <td class="mytable-col-md text-center">Elderly Ambulatory</td>
            <td class="mytable-col-md text-center">Elderly Non-Ambulatory</td>
            <td class="mytable-col-md text-center">Non-Elderly Ambulatory</td>
            <td class="mytable-col-md text-center">Non-Elderly Non-Ambulatory</td>
            <td class="mytable-col-md text-center">Unknown</td>
            <td class="mytable-col-md text-center">Total</td>
            <td class="mytable-col-md text-center">Staff</td>
            <td class="mytable-col-md text-center">Total (with staff)</td>
        </thead>
        <tr>
            <td class="mytable-col-md">Trips on vehicle</td>
            {% for trip_count in report.unique_riders.by_trips %}
            <td class="mytable-col-sm {% if trip_count.passenger == 0 %}mytable-zero{%endif%}">{{trip_count.passenger}}</td>
            {% endfor %}
        </tr>
        <tr>
            <td class="mytable-col-md">Trips not on vehicle</td>
            {% for trip_count in report.unique_riders.by_trips %}
            <td class="mytable-col-sm {% if trip_count.no_passenger == 0 %}mytable-zero{%endif%}">{{trip_count.no_passenger}}</td>
            {% endfor %}
        </tr>
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            {% for trip_count in report.unique_riders.by_trips %}
            <td class="mytable-col-sm text-center{% if trip_count.total == 0 %}mytable-zero{%endif%}">{{trip_count.total}}</td>
            {% endfor %}
        </tr>
    </table>
    <br/>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-lg">Name</td>
            <td class="mytable-col-sm">Elderly</td>
            <td class="mytable-col-sm">Ambulatory</td>
            <td class="mytable-col-sm">Trips on vehicle</td>
            <td class="mytable-col-sm">Trips not on vehicle</td>
            <td class="mytable-col-sm">Total Trips</td>
        </thead>
        <tbody class="mytable-hoverhi">
            {% for rider in report.unique_riders.names %}
            {% if rider.trips.total > 0 %}
            <tr>
                <td class="mytable-col-lg">
                    <div class="dropdown ajax-blocker">
                        <a href="#_" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{rider.name}}</a>
                        {% if rider.staff %}
                        <span class="badge badge-secondary ml-1">Staff</span>
                        {% endif %}
                        <div class="dropdown-menu shadow">
                            <h5 class="pl-3 pr-3">{{rider.name}}</h5>
                            <div class="dropdown-divider"></div>
                            <a target="_blank" class="dropdown-item" href="{% url 'search' %}?name={{rider.name|urlencode}}&start_date_year={{date_start.year}}&start_date_month={{date_start.month}}&start_date_day={{date_start.day}}&end_date_year={{date_end.year}}&end_date_month={{date_end.month}}&end_date_day={{date_end.day}}{% if selected_driver %}&driver={{ selected_driver.id }}{% endif %}">
                                <span class="oi oi-magnifying-glass mr-2"></span>Search for trips<br/><span class="small">From {{date_start}} - {{date_end}}</span>
                            </a>
                            {% if rider.client_id %}
                            <div class="dropdown-divider"></div>
                            {% if selected_driver %}
                            <a target="_blank" href="{% url 'client-report-by-driver' rider.client_id selected_driver.id date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day %}" class="dropdown-item">
                            {% else %}
                            <a target="_blank" href="{% url 'client-report' rider.client_id date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day %}" class="dropdown-item">
                            {% endif %}
                                <span class="oi oi-graph mr-2"></span>View Client Report<br/><span class="small">From {{date_start}} - {{date_end}}</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a target="_blank" href="{% url 'client-payments' rider.client_id %}" class="dropdown-item"><span class="oi oi-dollar mr-2"></span>View Client Payments</a>
                            <div class="dropdown-divider"></div>
                            <a target="_blank" class="dropdown-item" href="{% url 'client-edit' rider.client_id %}">
                                <span class="oi oi-person mr-2"></span>Edit Client
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td class="mytable-col-sm">{% if rider.elderly %}<span class="oi oi-check"></span>{% elif rider.elderly == False %}<span class="oi oi-x"></span>{% endif %}</td>
                <td class="mytable-col-sm">{% if rider.ambulatory %}<span class="oi oi-check"></span>{% elif rider.ambulatory == False %}<span class="oi oi-x"></span>{% endif %}</td>
                <td class="mytable-col-sm {% if rider.trips.passenger == 0 %}mytable-zero{% endif %}">{{rider.trips.passenger}}</td>
                <td class="mytable-col-sm {% if rider.trips.no_passenger == 0 %}mytable-zero{% endif %}">{{rider.trips.no_passenger}}</td>
                <td class="mytable-col-sm {% if rider.trips.total == 0 %}mytable-zero{% endif %}">{{rider.trips.total}}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif%}

<div id="report_tags">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Trip Types and Tags</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-lg">Trip Type</td>
            <td class="mytable-col-sm">Trips on vehicle</td>
            <td class="mytable-col-sm">Trips not on vehicle</td>
            <td class="mytable-col-sm">Total Trips</td>
        </thead>
        <tbody class="mytable-hoverhi">
            {% for key, value in report.all_vehicles.trip_types.items %}
            <tr>
                <td class="mytable-col-lg">{{key}}</td>
                <td class="mytable-col-sm {% if value.passenger == 0 %}mytable-zero{%endif%}">{{value.passenger}}</td>
                <td class="mytable-col-sm {% if value.no_passenger == 0 %}mytable-zero{%endif%}">{{value.no_passenger}}</td>
                <td class="mytable-col-sm {% if value.total == 0 %}mytable-zero{%endif%}">{{value.total}}</td>
            </tr>
            {% endfor %}
            <tr>
                <td class="mytable-col-lg">Unknown</td>
                <td class="mytable-col-sm {% if report.all_vehicles.trip_types_unknown.passenger == 0 %}mytable-zero{%endif%}">{{report.all_vehicles.trip_types_unknown.passenger}}</td>
                <td class="mytable-col-sm {% if report.all_vehicles.trip_types_unknown.no_passenger == 0 %}mytable-zero{%endif%}">{{report.all_vehicles.trip_types_unknown.no_passenger}}</td>
                <td class="mytable-col-sm {% if report.all_vehicles.trip_types_unknown.total == 0 %}mytable-zero{%endif%}">{{report.all_vehicles.trip_types_unknown.total}}</td>
            </tr>
            <tr class="bg-success text-light text-bold">
                <td class="mytable-col-lg">TOTAL</td>
                <td class="mytable-col-sm text-center">{{ report.all_vehicles.trip_types_total.passenger }}</td>
                <td class="mytable-col-sm text-center">{{ report.all_vehicles.trip_types_total.no_passenger }}</td>
                <td class="mytable-col-sm text-center">{{ report.all_vehicles.trip_types_total.total }}</td>
            </tr>
        </tbody>
    </table>
    <br/>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-lg">Tag</td>
            <td class="mytable-col-sm">Trips on vehicle</td>
            <td class="mytable-col-sm">Trips not on vehicle</td>
            <td class="mytable-col-sm">Total Trips</td>
        </thead>
        <tbody class="mytable-hoverhi">
            {% for key, value in report.all_vehicles.tags.items %}
            <tr>
                <td class="mytable-col-lg">{{key}}</td>
                <td class="mytable-col-sm {% if value.passenger == 0 %}mytable-zero{%endif%}">{{value.passenger}}</td>
                <td class="mytable-col-sm {% if value.no_passenger == 0 %}mytable-zero{%endif%}">{{value.no_passenger}}</td>
                <td class="mytable-col-sm {% if value.total == 0 %}mytable-zero{%endif%}">{{value.total}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if report.frequent_destinations %}
<div id="report_destinations">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Frequent Destinations</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-lg">Address</td>
            <td class="mytable-col-sm">Trips on vehicle</td>
            <td class="mytable-col-sm">Trips not on vehicle</td>
            <td class="mytable-col-sm">Total Trips</td>
            <td class="mytable-col-sm">Average Mileage</td>
        </thead>
        <tbody class="mytable-hoverhi">
            {% for destination in report.frequent_destinations %}
            <tr>
                <td class="mytable-col-lg">{{ destination.address }}</td>
                <td class="mytable-col-sm {% if destination.trips.passenger == 0 %}mytable-zero{%endif%}">{{destination.trips.passenger}}</td>
                <td class="mytable-col-sm {% if destination.trips.no_passenger == 0 %}mytable-zero{%endif%}">{{destination.trips.no_passenger}}</td>
                <td class="mytable-col-sm {% if destination.trips.total == 0 %}mytable-zero{%endif%}">{{destination.trips.total}}</td>
                <td class="mytable-col-sm {% if destination.avg_mileage == 0 %}mytable-zero{%endif%}">{{destination.avg_mileage|floatformat:1}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if report.unique_riders.names or report.money_payments %}
<div id="report_fares">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Fares &amp; Payments (by client)</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-lg">Name</td>
            <td class="mytable-col-md">Cash (driver collected)</td>
            <td class="mytable-col-md">Check (driver collected)</td>
            <td class="mytable-col-md">Cash (not driver collected)</td>
            <td class="mytable-col-md">Check (not driver collected)</td>
            <td class="mytable-col-md">Total Payments</td>
            <td class="mytable-col-md">Total Fares</td>
            <td class="mytable-col-md">Total Owed</td>
        </thead>
        <tbody class="mytable-hoverhi">
            {% for rider in report.unique_riders.names %}
            {% if rider.total_payments.value > 0 or rider.total_fares.value > 0 %}
            <tr>
                <td class="mytable-col-lg">
                    <div class="dropdown ajax-blocker">
                        <a href="#_" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{rider.name}}</a>
                        <div class="dropdown-menu shadow">
                            <h5 class="pl-3 pr-3">{{rider.name}}</h5>
                            <div class="dropdown-divider"></div>
                            <a target="_blank" class="dropdown-item" href="{% url 'search' %}?name={{rider.name|urlencode}}&start_date_year={{date_start.year}}&start_date_month={{date_start.month}}&start_date_day={{date_start.day}}&end_date_year={{date_end.year}}&end_date_month={{date_end.month}}&end_date_day={{date_end.day}}{% if selected_driver %}&driver={{ selected_driver.id }}{% endif %}">
                                <span class="oi oi-magnifying-glass mr-2"></span>Search for trips<br/><span class="small">From {{date_start}} - {{date_end}}</span>
                            </a>
                            {% if rider.client_id %}
                            <div class="dropdown-divider"></div>
                            {% if selected_driver %}
                            <a target="_blank" href="{% url 'client-report-by-driver' rider.client_id selected_driver.id date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day %}" class="dropdown-item">
                            {% else %}
                            <a target="_blank" href="{% url 'client-report' rider.client_id date_start.year date_start.month date_start.day date_end.year date_end.month date_end.day %}" class="dropdown-item">
                            {% endif %}
                                <span class="oi oi-graph mr-2"></span>View Client Report<br/><span class="small">From {{date_start}} - {{date_end}}</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a target="_blank" href="{% url 'client-payments' rider.client_id %}" class="dropdown-item"><span class="oi oi-dollar mr-2"></span>View Client Payments</a>
                            <div class="dropdown-divider"></div>
                            <a target="_blank" class="dropdown-item" href="{% url 'client-edit' rider.client_id %}">
                                <span class="oi oi-person mr-2"></span>Edit Client
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td class="mytable-col-md {% if rider.collected_cash.value == 0 %}mytable-zero{%endif%}">{{ rider.collected_cash }}</td>
                <td class="mytable-col-md {% if rider.collected_check.value == 0 %}mytable-zero{%endif%}">{{ rider.collected_check }}</td>
                <td class="mytable-col-md {% if rider.paid_cash.value == 0 %}mytable-zero{%endif%}">{{ rider.paid_cash }}</td>
                <td class="mytable-col-md {% if rider.paid_check.value == 0 %}mytable-zero{%endif%}">{{ rider.paid_check }}</td>
                <td class="mytable-col-md {% if rider.total_payments.value == 0 %}mytable-zero{%endif%}">{{ rider.total_payments }}</td>
                <td class="mytable-col-md {% if rider.total_fares.value == 0 %}mytable-zero{%endif%}">{{ rider.total_fares }}</td>
                <td class="mytable-col-md {% if rider.total_owed.value == 0 %}mytable-zero{%endif%}">{{ rider.total_owed }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-lg">TOTAL</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_collected_cash }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_collected_check }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_paid_cash }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_paid_check }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_total_payments }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_total_fares }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_total_owed }}</td>
        </tr>
    </table>
</div>
{% endif %}

{% if report.unique_riders.names or report.money_payments %}
<div id="report_fares_by_date">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Fares &amp; Payments (by date)</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md">Date</td>
            <td class="mytable-col-md">Cash (driver collected)</td>
            <td class="mytable-col-md">Check (driver collected)</td>
            <td class="mytable-col-md">Cash (not driver collected)</td>
            <td class="mytable-col-md">Check (not driver collected)</td>
            <td class="mytable-col-md">Total Payments</td>
            <td class="mytable-col-md">Total Fares</td>
        </thead>
        {% if show_daily_data or is_short_report %}
        <tbody class="mytable-hoverhi">
            {% for day in report.report_all %}
            {% if day.total_payments.value > 0 or day.total_fares.value > 0 %}
            <tr>
                <td class="mytable-col-md"><a href="{% url 'schedule' 'edit' day.date.year day.date.month day.date.day %}">{{day.date|date:"M j, Y"}}</a></td>
                <td class="mytable-col-md {% if day.collected_cash.value == 0 %}mytable-zero{%endif%}">{{ day.collected_cash }}</td>
                <td class="mytable-col-md {% if day.collected_check.value == 0 %}mytable-zero{%endif%}">{{ day.collected_check }}</td>
                <td class="mytable-col-md {% if day.paid_cash.value == 0 %}mytable-zero{%endif%}">{{ day.paid_cash }}</td>
                <td class="mytable-col-md {% if day.paid_check.value == 0 %}mytable-zero{%endif%}">{{ day.paid_check }}</td>
                <td class="mytable-col-md {% if day.total_payments.value == 0 %}mytable-zero{%endif%}">{{ day.total_payments }}</td>
                <td class="mytable-col-md {% if day.total_fares.value == 0 %}mytable-zero{%endif%}">{{ day.total_fares }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
        {% endif %}
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_collected_cash }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_collected_check }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_paid_cash }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_paid_check }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_total_payments }}</td>
            <td class="mytable-col-md">{{ report.unique_riders.total_total_fares }}</td>
        </tr>
        {% if not show_daily_data and not is_short_report %}
        <tr>
            <td colspan="7" class="small text-center alert-warning">Daily report data is hidden</td>
        </tr>
        {% endif %}
    </table>
</div>
{% endif %}

{% if report.money_trips %}
<div id="report_collected_money">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Money Collected by the Drivers</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md">Date</td>
            <td class="mytable-col-lg">Name</td>
            <td class="mytable-col-sm">Cash</td>
            <td class="mytable-col-sm">Check</td>
        </thead>
        {% if show_daily_data or is_short_report %}
        <tbody class="mytable-hoverhi">
            {% for money_trip in report.money_trips %}
            <tr>
                <td class="mytable-col-md"><a href="{% url 'trip-edit' 'edit' money_trip.trip.id %}">{{ money_trip.trip.date|date:"M j, Y" }}</a></td>
                <td class="mytable-col-lg">{{ money_trip.trip.name }}</td>
                <td class="mytable-col-sm {% if money_trip.collected_cash.value == 0 %}mytable-zero{%endif%}">{{ money_trip.collected_cash}}</td>
                <td class="mytable-col-sm {% if money_trip.collected_check.value == 0 %}mytable-zero{%endif%}">{{ money_trip.collected_check}}</td>
            </tr>
            {% endfor %}
        </tbody>
        {% endif %}
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-lg"></td>
            <td class="mytable-col-sm">{{ report.money_trips_summary.collected_cash}}</td>
            <td class="mytable-col-sm">{{ report.money_trips_summary.collected_check}}</td>
        </tr>
        {% if not show_daily_data and not is_short_report %}
        <tr>
            <td colspan="4" class="small text-center alert-warning">Daily report data is hidden</td>
        </tr>
        {% endif %}
    </table>
</div>
{% endif %}

{% if report.money_payments %}
<div id="report_payments">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Money Not Collected by the Drivers</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md">Date</td>
            <td class="mytable-col-lg">Name</td>
            <td class="mytable-col-sm">Cash</td>
            <td class="mytable-col-sm">Check</td>
        </thead>
        {% if show_daily_data or is_short_report %}
        <tbody class="mytable-hoverhi">
            {% for money_payment in report.money_payments %}
            <tr>
                <td class="mytable-col-md"><a href="{% url 'client-payment-edit' money_payment.client.id money_payment.id %}">{{ money_payment.date }}</a></td>
                <td class="mytable-col-lg">{{ money_payment.client.name }}</td>
                <td class="mytable-col-sm {% if money_payment.cash.value == 0 %}mytable-zero{%endif%}">{{ money_payment.cash}}</td>
                <td class="mytable-col-sm {% if money_payment.check.value == 0 %}mytable-zero{%endif%}">{{ money_payment.check}}</td>
            </tr>
            {% endfor %}
        </tbody>
        {% endif %}
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-lg"></td>
            <td class="mytable-col-sm">{{ report.money_payments_summary.cash}}</td>
            <td class="mytable-col-sm">{{ report.money_payments_summary.check}}</td>
        </tr>
        {% if not show_daily_data and not is_short_report %}
        <tr>
            <td colspan="4" class="small text-center alert-warning">Daily report data is hidden</td>
        </tr>
        {% endif %}
    </table>
</div>
{% endif %}

{% if report.driver_reports %}
<div id="report_drivers">
    <hr/>
    <div class="row">
        <div class="col">
            <h3>Per-Driver Summary</h3>
        </div>
        <div class="col-auto">
            <a href="#" title="Back to top" class="small text-muted"><span class="oi oi-caret-top mr-1"></span>Back to top</a>
        </div>
    </div>
    <table class="mytable mytable-striped">
        <thead>
            <td class="mytable-col-md">Driver</td>
            <td class="mytable-col-sm">Service Miles</td>
            <td class="mytable-col-sm">Service Hours</td>
            <td class="mytable-col-sm">Deadhead Miles</td>
            <td class="mytable-col-sm">Deadhead Hours</td>
            <td class="mytable-col-sm">Total Miles</td>
            <td class="mytable-col-sm">Total Hours</td>
            <td class="mytable-col-sm">Days of Service</td>
        </thead>
        {% for d in report.driver_reports %}
        <tr style="background: #{{d.driver.get_color}}">
            <td class="mytable-col-md">{{d.driver}}</td>
            <td class="mytable-col-sm {% if d.totals.service_miles == 0 %}mytable-zero{%endif%}">{{d.totals.service_miles|floatformat:1}}</td>
            <td class="mytable-col-sm {% if d.totals.service_hours == 0 %}mytable-zero{%endif%}">{{d.totals.service_hours|floatformat:2}}</td>
            <td class="mytable-col-sm {% if d.totals.deadhead_miles == 0 %}mytable-zero{%endif%}">{{d.totals.deadhead_miles|floatformat:1}}</td>
            <td class="mytable-col-sm {% if d.totals.deadhead_hours == 0 %}mytable-zero{%endif%}">{{d.totals.deadhead_hours|floatformat:2}}</td>
            <td class="mytable-col-sm {% if d.totals.total_miles == 0 %}mytable-zero{%endif%}">{{d.totals.total_miles|floatformat:1}}</td>
            <td class="mytable-col-sm {% if d.totals.total_hours == 0 %}mytable-zero{%endif%}">{{d.totals.total_hours|floatformat:2}}</td>
            <td class="mytable-col-sm {% if d.days|length == 0 %}mytable-zero{%endif%}">{{d.days|length}}</td>
        </tr>
        {% endfor %}
        <tr class="bg-success text-light text-bold">
            <td class="mytable-col-md">TOTAL</td>
            <td class="mytable-col-sm {% if report.driver_reports_total.totals.service_miles == 0 %}mytable-zero{%endif%}">{{report.driver_reports_total.totals.service_miles|floatformat:1}}</td>
            <td class="mytable-col-sm {% if report.driver_reports_total.totals.service_hours == 0 %}mytable-zero{%endif%}">{{report.driver_reports_total.totals.service_hours|floatformat:2}}</td>
            <td class="mytable-col-sm {% if report.driver_reports_total.totals.deadhead_miles == 0 %}mytable-zero{%endif%}">{{report.driver_reports_total.totals.deadhead_miles|floatformat:1}}</td>
            <td class="mytable-col-sm {% if report.driver_reports_total.totals.deadhead_hours == 0 %}mytable-zero{%endif%}">{{report.driver_reports_total.totals.deadhead_hours|floatformat:2}}</td>
            <td class="mytable-col-sm {% if report.driver_reports_total.totals.total_miles == 0 %}mytable-zero{%endif%}">{{report.driver_reports_total.totals.total_miles|floatformat:1}}</td>
            <td class="mytable-col-sm {% if report.driver_reports_total.totals.total_hours == 0 %}mytable-zero{%endif%}">{{report.driver_reports_total.totals.total_hours|floatformat:2}}</td>
            <td class="mytable-col-sm {% if report.total_vehicle_days_of_service == 0 %}mytable-zero{%endif%}">{{report.total_vehicle_days_of_service}}</td>
        </tr>
    </table>
</div>
{% endif %}

<hr/>
<div>
    <span class="text-muted small"><strong>Report load times:</strong> Database - {{report.perf_database|floatformat:3}} seconds | Processing - {{report.perf_processing|floatformat:3}} seconds</span>
</div>
</div>
<script type="text/javascript" src="{% static 'transit/js/report/common.js' %}"></script>
<script type="text/javascript" src="{% static 'transit/js/report/view.js' %}"></script>
<script type="text/javascript">
    fixDatePicker();
    fixSectionPicker();

    var visible = new ReportVisibility();
    visible.addSection("#report_errors", "#vis_errors");
    visible.addSection("#report_MAP", "#vis_MAP");
    visible.addSection("#report_vehicle_totals", "#vis_vehicle_totals");
    {% for v in vehicles %}
    visible.addSection("#report_vehicle_{{v.id}}", "#vis_vehicle_{{v.id}}");
    {% endfor %}
    visible.addSection("#report_riders", "#vis_riders");
    visible.addSection("#report_tags", "#vis_tags");
    visible.addSection("#report_destinations", "#vis_destinations");
    visible.addSection("#report_fares", "#vis_fares");
    visible.addSection("#report_fares_by_date", "#vis_fares_by_date");
    visible.addSection("#report_collected_money", "#vis_collected_money");
    visible.addSection("#report_payments", "#vis_payments");
    visible.addSection("#report_drivers", "#vis_drivers");

    visibleLoad(visible);

</script>
{% endblock %}

{% block content %}
<p>You are not authorized. Please <a href="{% url 'login' %}?next={{ request.path }}">log in</a>.</p>
{% endblock %}
