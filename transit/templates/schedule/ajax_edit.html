<div class="alert {% if message %}alert-info{% else %}alert-secondary{% endif %} p-1">
    <div class="row">
        <div class="col-auto pr-0">
            <a href="{% url 'schedule-message' date.year date.month date.day %}" class="btn btn-outline-dark btn-sm"><span class="oi oi-comment-square mr-2"></span>Edit</a>
        </div>
        <div class="col">
            <strong style="font-size: 1.3em">{{ message }}</strong>
        </div>
    </div>
</div>
<hr/>
<h3>Shifts <a class="btn btn-secondary" href="{% url 'shift-create' 'edit' date.year date.month date.day %}"><span class="oi oi-plus mr-2"></span>New</a></h3>
{% if shifts %}
<table class="mytable">
    <thead>
        <td></td>
        <td>Driver</td>
        <td>Vehicle</td>
        <td>Start Miles</td>
        <td>Start Time</td>
        <td>End Miles</td>
        <td>End Time</td>
        <td>Fuel (gal)</td>
    </thead>
    {% for shift in shifts %}
    <tr style="background: #{{ shift.get_driver_color }};">
        <td class="mytable-col-xs">
            <div class="dropdown ajax-blocker">
                <button class="btn btn-outline-dark btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="oi oi-pencil"></span>
                </button>
                <div class="dropdown-menu">
                    <a href="{% url 'shift-edit' 'edit' shift.id %}" class="dropdown-item">Edit shift</a>
                    <hr/>
                    <a href="{% url 'shift-delete' 'edit' shift.id %}" class="dropdown-item text-danger">Delete shift</a>
                </div>
            </div>
        </td>
        <td class="mytable-col-md">{{ shift.driver }}</td>
        <td class="mytable-col-md">{{ shift.vehicle }}</td>
        <td class="mytable-col-sm">
            {% if shift.check_start_miles %}
                {{ shift.start_miles }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-sm">
            {% if shift.check_start_time %}
                {{ shift.start_time }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-sm">
            {% if shift.check_end_miles %}
                {{ shift.end_miles }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-sm">
            {% if shift.check_end_time %}
                {{ shift.end_time }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-sm">{{ shift.fuel }}</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>There are no shifts for this day.</p>
{% endif %}
<hr/>
<h3>
    Trips
    <a class="btn btn-secondary" href="{% url 'trip-create' 'edit' date.year date.month date.day %}"><span class="oi oi-plus mr-2"></span>New</a>
        <span class="dropdown ajax-blocker">
            <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="oi oi-list mr-2"></span>Templates
            </button>
            <div class="dropdown-menu">
                {% for template in templates %}
                <a class="dropdown-item" href="#_" onclick="ajax_loader.run('', 'load_template', '{{template.id}}')">{{template}}</a>
                {% endfor %}
            </div>
        </span>
</h3>
</div>
{% if trips %}
<table class="mytable">
    <thead>
        <td></td>
        <td></td>
        <td>Pick up</td>
        <td>Appt. time</td>
        <td>Name</td>
        <td>Address</td>
        <td>Phone #</td>
        <td>Destination</td>
        <td>Driver</td>
        <td>Vehicle</td>
        <td>Start Miles</td>
        <td>Start Time</td>
        <td>End Miles</td>
        <td>End Time</td>
        <td></td>
    </thead>
    {% for trip in trips %}
    <tr style="background: #{{ trip.get_driver_color }};">
        <td class="mytable-col-arrows">
            <a id="trip_{{ trip.id }}"></a>
            <div class="btn-group-vertical">
                <button class="btn btn-outline-dark btn-sm pt-0 pb-0" onclick="ajax_loader.run('{{ trip.id }}', 'mv', 'u')"><span class="oi oi-chevron-top"></span></button>
                <button class="btn btn-outline-dark btn-sm pt-0 pb-0" onclick="ajax_loader.run('{{ trip.id }}', 'mv', 'd')"><span class="oi oi-chevron-bottom"></span></button>
            </div>
        </td>
        <td class="mytable-col-xs">
            <div class="dropdown ajax-blocker">
                <button class="btn btn-outline-dark btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="oi oi-pencil"></span>
                </button>
                <div class="dropdown-menu">
                    <a href="{% url 'trip-edit' 'edit' trip.id %}" class="dropdown-item">Edit trip</a>
                    {% if trip.status > 0 %}<a href="#_" onclick="ajax_loader.run('{{ trip.id }}', 'toggle_canceled', '0')" class="dropdown-item">Reset Status</a>{% endif %}
                    {% if trip.status == 0 %}<a href="#_" onclick="ajax_loader.run('{{ trip.id }}', 'toggle_canceled', '1')" class="dropdown-item">Set as canceled</a>{% endif %}
                    {% if trip.status == 0 %}<a href="#_" onclick="ajax_loader.run('{{ trip.id }}', 'toggle_canceled', '2')" class="dropdown-item">Set as no show</a>{% endif %}
                    <hr/>
                    <a href="{% url 'client-create-from-trip' trip.id %}" class="dropdown-item">Create Client</a>
                    <a href="{% url 'trip-create-return' 'edit' trip.id %}" class="dropdown-item">Create Return Trip</a>
                    <hr/>
                    <a href="{% url 'trip-delete' 'edit' trip.id %}" class="dropdown-item text-danger">Delete trip</a>
                </div>
            </div>
        </td>
        <td class="mytable-col-sm">{{ trip.pick_up_time }}</td>
        <td class="mytable-col-sm">{{ trip.appointment_time }}</td>
        <td class="mytable-col-md">{{ trip.name }}</td>
        <td class="mytable-col-lg">{{ trip.address }}</td>
        <td class="mytable-col-md" style="white-space: nowrap;">
            {% if trip.phone_home and trip.phone_cell %}
            {{ trip.phone_home }}<br/>{{ trip.phone_cell }}
            {% elif not trip.phone_home and trip.phone_cell %}
            {{ trip.phone_cell }}
            {% elif trip.phone_home and not trip.phone_cell %}
            {{ trip.phone_home }}
            {% endif %}
        </td>
        <td class="mytable-col-lg">{{ trip.destination }}</td>
        <td class="mytable-col-md">
            <div class="dropdown ajax-blocker">
                <button class="btn btn-outline-dark btn-sm w-100 dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% if trip.driver is None %}---------{% else %}{% for driver in drivers %}{% if trip.driver == driver %}{{ driver }}{% endif %}{% endfor %}{% endif %}
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item {% if trip.driver is None %}active{% endif %}" href="#_" onclick="ajax_loader.run('{{trip.id}}', 'set_driver', '---------')">---------</a>
                    {% for driver in drivers %}
                    <a class="dropdown-item {% if trip.driver == driver %}active{% endif %}" href="#_" onclick="ajax_loader.run('{{trip.id}}', 'set_driver', '{{driver.id}}')">{{driver}}</a>
                    {% endfor %}
                </div>
            </div>
        </td>
        <td class="mytable-col-md">
            <div class="dropdown ajax-blocker">
                <button class="btn btn-outline-dark btn-sm w-100 dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% if trip.vehicle is None %}---------{% else %}{% for vehicle in vehicles %}{% if trip.vehicle == vehicle %}{{ vehicle }}{% endif %}{% endfor %}{% endif %}
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item {% if trip.vehicle is None %}active{% endif %}" href="#_" onclick="ajax_loader.run('{{trip.id}}', 'set_vehicle', '---------')">---------</a>
                    {% for vehicle in vehicles %}
                    <a class="dropdown-item {% if trip.vehicle == vehicle %}active{% endif %}" href="#_" onclick="ajax_loader.run('{{trip.id}}', 'set_vehicle', '{{vehicle.id}}')">{{vehicle}}</a>
                    {% endfor %}
                </div>
            </div>
        </td>
        <td class="mytable-col-sm">
            {% if trip.check_start_miles %}
                {{ trip.start_miles }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-sm">
            {% if trip.check_start_time %}
                {{ trip.start_time }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-sm">
            {% if trip.check_end_miles %}
                {{ trip.end_miles }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-sm">
            {% if trip.check_end_time %}
                {{ trip.end_time }}
            {% else %}
                <span title="Missing log data" class="oi oi-minus lg-icon"></span>
            {% endif %}
        </td>
        <td class="mytable-col-xs">
            <div class="dropdown ajax-blocker">
                <button class="btn btn-outline-dark btn-sm w-100 dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {% if trip.note %}
                    <span class="oi oi-document"></span>
                    {% else %}
                    <span class="oi oi-ellipses"></span>
                    {% endif %}
                </button>
                <div class="dropdown-menu dropdown-menu-right p-2">
                    <div class="list-group list-group-flush" style="width: 300px">
                        <div class="list-group-item p-1">
                            <div class="row">
                                <div class="col text-muted">Trip Type</div>
                                <div class="col-auto">
                                    {% if trip.trip_type %}
                                    {% if trip.trip_type.name == 'Medical' %}
                                    <span class="badge badge-danger"><span class="oi oi-medical-cross mr-1"></span>{{trip.trip_type}}</span>
                                    {% else %}
                                    <span class="badge badge-primary">{{trip.trip_type}}</span>
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="list-group-item p-1">
                            <div class="row">
                                <div class="col text-muted">Elderly?</div>
                                <div class="col-auto">
                                    {% if trip.elderly %}
                                    <span class="oi oi-check"></span>
                                    {% elif trip.elderly is False %}
                                    <span class="oi oi-x"></span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="list-group-item p-1">
                            <div class="row">
                                <div class="col text-muted">Ambulatory?</div>
                                <div class="col-auto">
                                    {% if trip.ambulatory %}
                                    <span class="oi oi-check"></span>
                                    {% elif trip.ambulatory is False %}
                                    <span class="oi oi-x"></span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="list-group-item p-1 {% if trip.note %}list-group-item-warning{% endif %}">
                            <div class="row">
                                <div class="col text-muted">Notes</div>
                                <div class="col-auto">{% if trip.note %}{{trip.note}}{% endif %}</div>
                            </div>
                        </div>
                        {% if trip.status > 0 %}
                        <div class="list-group-item p-1">
                            {% if trip.status == 1 %}
                            <span class="badge badge-secondary">Canceled</span>
                            {% elif trip.status == 2 %}
                            <span class="badge badge-secondary">No Show</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>There are no trips for this day.</p>
{% endif %}
